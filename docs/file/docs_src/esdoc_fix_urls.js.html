<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">docs_src/esdoc_fix_urls.js | path.ux</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="this is awesome library"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="path.ux"><meta property="twitter:description" content="this is awesome library"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/joeedh/path.ux.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Flags">Flags</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">docs_src/esdoc_fix_urls.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">let marked = require(&quot;marked&quot;)
let fs = require(&quot;fs&quot;);
let pathmod = require(&quot;path&quot;);
const EPlugin = require(&apos;esdoc/out/src/Plugin/Plugin&apos;).default;

let manualBasePath = &quot;./&quot;;

function* listdir(path) {
  let d = fs.opendirSync(path, {});

  for (let item=d.readSync(); item; item=d.readSync()) {
    yield item;
  }
  d.close();
}

function doManual(p) {
  console.log(&quot;Generating manual paths... &quot;);
  let opt = p.option;

  if (!p.option) {
    return;
  }

  let base = manualBasePath;
  for (let item of listdir(base)) {
    if (item.isDirectory()) {
      continue;
    }

    path = base + &quot;/&quot; + item.name;

    let extok = item.name.toLowerCase().endsWith(&quot;.md&quot;);
    extok = extok || item.name.toLowerCase().endsWith(&quot;.html&quot;);

    if (!extok) {
      continue;
    }
    if (p.option.files.indexOf(path) &gt;= 0) {
      continue;
    }
    p.option.files.push(path);
  }

  console.log(p.option.files);
}


class Plugin {
  onHandleDocs(ev) {
    if (this.option &amp;&amp; this.option.manualBasePath) {
      manualBasePath = this.option.manualBasePath;
    }

    function test(path) {
      for (let p of listdir(manualBasePath)) {
        if (p.name.trim() === path) {
          return path;
        }
      }
      if (fs.existsSync(path)) {
        ///return path;
      }

      return undefined;
    }

    let re = /\@[a-zA-Z_$]+[a-zA-Z0-9_$]*/;

    function handleRefLink(href, title, text) {
      let matches = [];

      let norm = (f) =&gt; {
        return f.replace(/\\/g, &quot;/&quot;).trim();
      }

      if (href.startsWith(&quot;@&quot;)) {
        href = norm(href.slice(1, href.length));

        console.log(href)

        for (let doc of ev.data.docs) {
          let w = 0;

          if (norm(doc.longname).endsWith(href)) {
            let longname = norm(doc.longname);
            let l = longname.length - href.length;
            let s = longname.slice(0, l);

            //console.log(&quot;   ------&gt;&quot;, s);

            if (s.endsWith(&quot;.js&quot;) || s.endsWith(&quot;~&quot;) || s.endsWith(&quot;#&quot;)) {
              matches.push([doc, norm(doc.longname), w]);
            }
            //console.log(&quot;-&gt;&gt;&gt;&gt;&gt;&gt;.&quot;, doc.longname);
          }

          if (norm(doc.name) === href) {
            matches.push([doc, norm(doc.name)]);
          }
        }
        console.log(&quot;----&quot;);
      }

      console.log(matches.length);
      let doc;
      let max = -1e17;

      for (let r of matches) {
        let doc2 = r[0], key = r[1];

        if (doc === undefined || key.length+r[2] &gt; max) {
          doc = doc2;
          max = key.length;
        }
      }

      if (doc) {
        let url = doc.longname.replace(/\.js/, &quot;.js.html&quot;)
        let type = doc.kind;

        url = type + &quot;/&quot; + url;
        console.log(doc)

        let path;

        if (doc.memberof) {
          if (doc.kind === &quot;class&quot;) {
            path = &quot;class/&quot; + doc.longname + &quot;.html&quot;;
          } else {
            path = doc.kind + &quot;/index.html#&quot;;

            if (doc.static &amp;&amp; doc.kind !== &quot;class&quot;) {
              path += &quot;static-&quot; + doc.kind + &quot;-&quot; + doc.name;
            } else {
              path += doc.name;
            }
          }
        } else {
          path = doc.longname;
        }

        if (path) {
          return {
            href  : path,
            title : title,
            text  : text
          }
        }
      }
    }

    marked.Renderer.prototype.link = function (href, title, text) {
      href = href.trim();

      console.log(href);

      let is_href = /https?:\/\//;
      is_href = href.trim().toLowerCase().search(is_href) == 0.0;

      if (!is_href &amp;&amp; !href.startsWith(&quot;@&quot;)) {
        let href2 = href.trim();

        href2 = href2.trim();
        if (href2.startsWith(&quot;./&quot;)) {
          href2 = href2.slice(2, href2.length);
        }

        while (href2.startsWith(&quot;/&quot;)) {
          href2 = href2.slice(1, href2.length).trim();
        }

        href = href2;

        if (href2.toLowerCase().endsWith(&quot;.md&quot;)) {
          href2 = href2.slice(0, href2.length - 3);
        }

        if (test(href2 + &quot;.md&quot;) || test(href2 + &quot;.Md&quot;) || test(href2 + &quot;.mD&quot;) || test(href2 + &quot;.MD&quot;)) {
          console.log(&quot;found manual page&quot;);
          href2 += &quot;.html&quot;;

          if (href2.search(&quot;manual&quot;) &lt; 0) {
            href = href2;
          } else {
            href = href2;
          }
        }
      }
      console.log(href, title, text, is_href);

      let hr = handleRefLink(href, title, text);
      if (hr) {
        href = &quot;../&quot; + hr.href;
        title = hr.title;
        text = hr.text;
      }

      if (this.options.sanitize) {
        try {
          var prot = decodeURIComponent(unescape(href))
            .replace(/[^\w:]/g, &apos;&apos;)
            .toLowerCase();
        } catch (e) {
          return text;
        }
        if (prot.indexOf(&apos;javascript:&apos;) === 0 || prot.indexOf(&apos;vbscript:&apos;) === 0 || prot.indexOf(&apos;data:&apos;) === 0) {
          return text;
        }
      }
      if (this.options.baseUrl &amp;&amp; !originIndependentUrl.test(href)) {
        href = resolveUrl(this.options.baseUrl, href);
      }
      var out = &apos;&lt;a href=&quot;&apos; + href + &apos;&quot;&apos;;
      if (title) {
        out += &apos; title=&quot;&apos; + title + &apos;&quot;&apos;;
      }
      out += &apos;&gt;&apos; + text + &apos;&lt;/a&gt;&apos;;
      return out;
    };

    for (let p of EPlugin._plugins) {
      if (p.name === &quot;esdoc-integrate-manual-plugin&quot;) {
        console.log(doManual(p));
      }
    }
  }
}

module.exports = new Plugin();

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
